# Makefile mejorado para ROSLOAD personalizado
# Compila sin problemas de ranlib para MinGW-w64 POSIX

CC = x86_64-w64-mingw32-gcc-posix
CFLAGS = -O2 -Wall -Wextra -std=c99 -DWIN32 -D_WIN32
LDFLAGS = -static-libgcc -mconsole

# Archivos fuente
SOURCES = rosload-custom.c
OBJECTS = $(SOURCES:.c=.o)
TARGET = rosload-custom.exe

# Regla principal
all: $(TARGET)

# Compilar el ejecutable
$(TARGET): $(OBJECTS)
	@echo "ðŸ”§ Enlazando ROSLOAD personalizado mejorado..."
	$(CC) $(OBJECTS) -o $(TARGET) $(LDFLAGS)
	@echo "âœ… ROSLOAD personalizado compilado exitosamente: $(TARGET)"
	@echo "ðŸ“Š TamaÃ±o: $(shell stat -c%s $(TARGET)) bytes"

# Compilar objetos
%.o: %.c
	@echo "ðŸ”¨ Compilando $<..."
	$(CC) $(CFLAGS) -c $< -o $@

# Instalar como rosload.exe
install: $(TARGET)
	@echo "ðŸ“¦ Instalando ROSLOAD personalizado..."
	cp $(TARGET) rosload.exe
	@echo "âœ… ROSLOAD personalizado instalado como rosload.exe"

# Limpiar
clean:
	@echo "ðŸ§¹ Limpiando archivos de compilaciÃ³n..."
	rm -f $(OBJECTS) $(TARGET) rosload.exe
	@echo "âœ… Limpieza completada"

# Verificar dependencias
check:
	@echo "ðŸ” Verificando dependencias..."
	@echo "CC: $(CC)"
	@echo "CFLAGS: $(CFLAGS)"
	@echo "LDFLAGS: $(LDFLAGS)"
	@echo "Fuentes: $(SOURCES)"
	@echo "Objetos: $(OBJECTS)"
	@echo "Target: $(TARGET)"

# Mostrar ayuda
help:
	@echo "Makefile para ROSLOAD personalizado mejorado"
	@echo ""
	@echo "Comandos disponibles:"
	@echo "  make        - Compilar ROSLOAD personalizado"
	@echo "  make install- Instalar como rosload.exe"
	@echo "  make clean  - Limpiar archivos de compilaciÃ³n"
	@echo "  make check  - Verificar dependencias"
	@echo "  make help   - Mostrar esta ayuda"
	@echo ""
	@echo "CaracterÃ­sticas:"
	@echo "  âœ… Sin problemas de ranlib"
	@echo "  âœ… Compatible con MinGW-w64 POSIX"
	@echo "  âœ… Funcionalidad completa de bootloader"
	@echo "  âœ… Modo seguro y debug"
	@echo "  âœ… Procesamiento de lÃ­nea de comandos"
	@echo "  âœ… Interfaz de usuario mejorada"

.PHONY: all clean install check help
